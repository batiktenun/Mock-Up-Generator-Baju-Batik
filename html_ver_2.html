<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Mockup Ringkas - Panel Kontrol Bawah</title>
<style>
:root {
  --accent: #0b66ff;
  --toolbar-bg: #f1f5f9;
  --panel-bg: #fff;
  --border-color: #e2e8f0;
}

body {
  font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
  margin: 0;
  padding: 0;
  background: #f6f7fb;
  color: #0b0b0b;
  display: flex;
  flex-direction: column;
  height: 100vh;
  overflow: hidden;
}

.header {
  background: var(--panel-bg);
  border-bottom: 1px solid var(--border-color);
  padding: 8px 16px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.toolbar {
  display: flex;
  gap: 8px;
  padding: 8px 16px;
  background: var(--toolbar-bg);
  border-bottom: 1px solid var(--border-color);
  flex-wrap: wrap;
}

.tool-icon {
  background: var(--panel-bg);
  border: 1px solid var(--border-color);
  border-radius: 6px;
  padding: 8px 12px;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 14px;
  transition: all 0.2s;
}

.tool-icon:hover {
  background: #e6eefc;
  border-color: var(--accent);
}

.tool-icon.active {
  background: #e6eefc;
  border-color: var(--accent);
  color: var(--accent);
}

.main-content {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.workspace {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  background: linear-gradient(180deg, #fff, #fafafa);
  padding: 20px;
  overflow: auto;
}

canvas {
  background: #fff;
  border-radius: 8px;
  box-shadow: 0 6px 18px rgba(0,0,0,.06);
  max-width: 100%;
  height: auto;
}

.control-panel {
  background: var(--panel-bg);
  border-top: 1px solid var(--border-color);
  padding: 12px 16px;
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.3s ease;
}

.control-panel.active {
  max-height: 300px;
  overflow-y: auto;
}

.control-group {
  margin-bottom: 12px;
}

.control-group label {
  display: block;
  font-size: 13px;
  margin-bottom: 6px;
  color: #444;
}

.row {
  display: flex;
  gap: 8px;
  align-items: center;
  margin-bottom: 8px;
}

input[type=range] {
  flex: 1;
}

button {
  background: var(--accent);
  color: #fff;
  border: 0;
  padding: 6px 10px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 13px;
}

button.secondary {
  background: #f1f5f9;
  color: #334155;
}

.step {
  background: #e6eefc;
  border: 1px solid #d0e4ff;
  color: #0b66ff;
  padding: 4px 8px;
  border-radius: 4px;
  cursor: pointer;
  font-size: 12px;
}

.badge {
  background: #f1f5f9;
  padding: 4px 8px;
  border-radius: 6px;
  font-size: 12px;
  display: flex;
  align-items: center;
  gap: 6px;
}

.controls-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 8px;
  margin-top: 8px;
}

.footer {
  font-size: 12px;
  color: #666;
  padding: 8px 16px;
  background: var(--toolbar-bg);
  border-top: 1px solid var(--border-color);
  text-align: center;
}

.hidden {
  display: none;
}
</style>
</head>
<body>

<div class="header">
  <h3 style="margin: 0; font-size: 16px;">Mockup Ringkas - Panel Kontrol Bawah</h3>
  <div style="display: flex; gap: 8px;">
    <button id="downloadBtn">Download PNG</button>
    <button id="resetBtn" class="secondary">Reset All</button>
  </div>
</div>

<div class="toolbar">
  <div class="tool-icon" data-panel="undoRedoPanel">
    <span>‚Ü∂</span> Undo/Redo
  </div>
  <div class="tool-icon" data-panel="uploadPanel">
    <span>üìÅ</span> Upload
  </div>
  <div class="tool-icon" data-panel="transformPanel">
    <span>‚ÜîÔ∏è</span> Transform
  </div>
  <div class="tool-icon" data-panel="displacePanel">
    <span>üåä</span> Displacement
  </div>
  <div class="tool-icon" data-panel="eraserPanel">
    <span>üßΩ</span> Eraser
  </div>
</div>

<div class="main-content">
  <div class="workspace">
    <canvas id="c" width="900" height="1100" aria-label="mockup canvas"></canvas>
  </div>
  
  <!-- Panel kontrol di bawah lembar kerja -->
  <div id="undoRedoPanel" class="control-panel hidden">
    <div class="control-group">
      <label>Undo & Redo</label>
      <div class="row">
        <button id="undoBtn" style="background:#f39c12">‚Ü∂ Undo</button>
        <button id="redoBtn" style="background:#f39c12" disabled>‚Ü∑ Redo</button>
      </div>
    </div>
  </div>

  <div id="uploadPanel" class="control-panel hidden">
    <div class="control-group">
      <label>Upload Gambar</label>
      <div class="row">
        <input id="shirtFile" type="file" accept="image/*" style="flex:1">
        <span style="font-size:12px; color:#666">Baju (PNG)</span>
      </div>
      <div class="row">
        <input id="patternFile" type="file" accept="image/*" style="flex:1">
        <span style="font-size:12px; color:#666">Motif</span>
      </div>
    </div>
  </div>

  <div id="transformPanel" class="control-panel hidden">
    <div class="control-group">
      <label>Transformasi</label>
      
      <div class="row">
        <span style="width:56px">Pos X</span>
        <button class="step" data-target="posX" data-step="-10">‚àí</button>
        <input id="posX" type="range" min="-2000" max="2000" value="450">
        <button class="step" data-target="posX" data-step="10">+</button>
      </div>

      <div class="row">
        <span style="width:56px">Pos Y</span>
        <button class="step" data-target="posY" data-step="-10">‚àí</button>
        <input id="posY" type="range" min="-2000" max="2000" value="550">
        <button class="step" data-target="posY" data-step="10">+</button>
      </div>

      <div class="row">
        <span style="width:56px">Scale</span>
        <button class="step" data-target="scale" data-step="-0.05">‚àí</button>
        <input id="scale" type="range" min="0.1" max="5" step="0.01" value="1">
        <button class="step" data-target="scale" data-step="0.05">+</button>
      </div>

      <div class="row">
        <span style="width:56px">Rotasi</span>
        <button class="step" data-target="rotation" data-step="-1">‚àí</button>
        <input id="rotation" type="range" min="-180" max="180" value="0">
        <button class="step" data-target="rotation" data-step="1">+</button>
      </div>

      <div class="row">
        <span style="width:56px">Opacity</span>
        <button class="step" data-target="opacity" data-step="-0.01">‚àí</button>
        <input id="opacity" type="range" min="0" max="1" step="0.01" value="1">
        <button class="step" data-target="opacity" data-step="0.01">+</button>
      </div>

      <div class="controls-grid">
        <div><button id="centerBtn" style="width:100%">Center</button></div>
        <div><button id="tileBtn" style="width:100%">Toggle Tile</button></div>
      </div>
    </div>
  </div>

  <div id="displacePanel" class="control-panel hidden">
    <div class="control-group">
      <label>Displacement</label>
      <div class="row">
        <div style="display:flex;align-items:center;gap:8px">
          <input id="displaceToggle" type="checkbox">
          <span style="font-size:13px">Aktifkan</span>
        </div>
        <div style="flex:1;display:flex;align-items:center;gap:8px">
          <button class="step" data-target="displaceStrength" data-step="-1">‚àí</button>
          <input id="displaceStrength" type="range" min="0" max="120" value="18">
          <button class="step" data-target="displaceStrength" data-step="1">+</button>
        </div>
      </div>
    </div>
  </div>

  <div id="eraserPanel" class="control-panel hidden">
    <div class="control-group">
      <label>Eraser (Brush)</label>
      <div class="row">
        <button id="eraserBtn">Eraser</button>
        <button id="resetEraseBtn" style="background:#e53e3e">Reset Erase</button>
      </div>
      
      <div class="row">
        <div class="badge">Size
          <button class="step" data-target="brushSize" data-step="-4">‚àí</button>
          <input id="brushSize" type="range" min="4" max="200" value="40" style="width:100px">
          <button class="step" data-target="brushSize" data-step="4">+</button>
        </div>
      </div>
      
      <div class="row">
        <div class="badge">Hard
          <button class="step" data-target="brushHard" data-step="-0.05">‚àí</button>
          <input id="brushHard" type="range" min="0" max="1" step="0.01" value="0.6" style="width:100px">
          <button class="step" data-target="brushHard" data-step="0.05">+</button>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="footer">
  Tip: Pinch untuk zoom halaman. Eraser nonaktif jika lebih dari 1 sentuhan.
</div>

<script>
// Inisialisasi panel kontrol
document.querySelectorAll('.tool-icon').forEach(icon => {
  icon.addEventListener('click', function() {
    const panelId = this.getAttribute('data-panel');
    const panel = document.getElementById(panelId);
    
    // Jika panel yang sama diklik lagi, sembunyikan
    if (this.classList.contains('active')) {
      this.classList.remove('active');
      panel.classList.remove('active');
      panel.classList.add('hidden');
    } else {
      // Nonaktifkan semua ikon dan sembunyikan semua panel
      document.querySelectorAll('.tool-icon').forEach(i => {
        i.classList.remove('active');
      });
      document.querySelectorAll('.control-panel').forEach(p => {
        p.classList.remove('active');
        p.classList.add('hidden');
      });
      
      // Aktifkan ikon dan panel yang dipilih
      this.classList.add('active');
      panel.classList.remove('hidden');
      panel.classList.add('active');
    }
  });
});

// Inisialisasi canvas
const c = document.getElementById('c');
const ctx = c.getContext('2d');

// Variabel global
let shirtImg = null;
let patternImg = null;
let patternState = { 
  x: c.width/2, 
  y: c.height/2, 
  scale: 1, 
  rot: 0, 
  alpha: 1, 
  tiled: false 
};

// Fungsi untuk menggambar background checkerboard
function drawCheckerBackground(context, w, h) {
  const size = 16;
  for(let y = 0; y < h; y += size) {
    for(let x = 0; x < w; x += size) {
      const even = ((x/size) + (y/size)) % 2 === 0;
      context.fillStyle = even ? '#f8f8f8' : '#efefef';
      context.fillRect(x, y, size, size);
    }
  }
}

// Gambar background checkerboard
drawCheckerBackground(ctx, c.width, c.height);

// Tambahkan teks placeholder
ctx.fillStyle = '#666';
ctx.font = '16px system-ui';
ctx.textAlign = 'center';
ctx.fillText('Upload baju dan motif untuk memulai', c.width/2, c.height/2);

// Event listener untuk file upload
document.getElementById('shirtFile').addEventListener('change', function(e) {
  const file = e.target.files[0];
  if (!file) return;
  
  const reader = new FileReader();
  reader.onload = function(event) {
    shirtImg = new Image();
    shirtImg.onload = function() {
      // Sesuaikan ukuran canvas dengan gambar baju
      const maxWidth = 900;
      const maxHeight = 1100;
      const ratio = Math.min(maxWidth / shirtImg.width, maxHeight / shirtImg.height, 1);
      c.width = Math.round(shirtImg.width * ratio);
      c.height = Math.round(shirtImg.height * ratio);
      
      // Gambar ulang
      drawCheckerBackground(ctx, c.width, c.height);
      ctx.drawImage(shirtImg, 0, 0, c.width, c.height);
      
      // Reset posisi pattern jika ada
      if (patternImg) {
        patternState.x = c.width/2;
        patternState.y = c.height/2;
      }
    };
    shirtImg.src = event.target.result;
  };
  reader.readAsDataURL(file);
});

document.getElementById('patternFile').addEventListener('change', function(e) {
  const file = e.target.files[0];
  if (!file) return;
  
  const reader = new FileReader();
  reader.onload = function(event) {
    patternImg = new Image();
    patternImg.onload = function() {
      // Gambar pattern di atas baju
      if (shirtImg) {
        ctx.drawImage(shirtImg, 0, 0, c.width, c.height);
      } else {
        drawCheckerBackground(ctx, c.width, c.height);
      }
      
      // Gambar pattern dengan pengaturan default
      ctx.save();
      ctx.translate(patternState.x, patternState.y);
      ctx.rotate(patternState.rot * Math.PI / 180);
      ctx.scale(patternState.scale, patternState.scale);
      ctx.globalAlpha = patternState.alpha;
      
      const patternWidth = patternImg.width * 0.6;
      const patternHeight = patternImg.height * 0.6;
      ctx.drawImage(patternImg, -patternWidth/2, -patternHeight/2, patternWidth, patternHeight);
      
      ctx.restore();
    };
    patternImg.src = event.target.result;
  };
  reader.readAsDataURL(file);
});

// Event listener untuk slider transformasi
['posX', 'posY', 'scale', 'rotation', 'opacity'].forEach(id => {
  document.getElementById(id).addEventListener('input', function() {
    if (!patternImg) return;
    
    patternState.x = Number(document.getElementById('posX').value);
    patternState.y = Number(document.getElementById('posY').value);
    patternState.scale = Number(document.getElementById('scale').value);
    patternState.rot = Number(document.getElementById('rotation').value);
    patternState.alpha = Number(document.getElementById('opacity').value);
    
    // Gambar ulang
    if (shirtImg) {
      ctx.drawImage(shirtImg, 0, 0, c.width, c.height);
    } else {
      drawCheckerBackground(ctx, c.width, c.height);
    }
    
    ctx.save();
    ctx.translate(patternState.x, patternState.y);
    ctx.rotate(patternState.rot * Math.PI / 180);
    ctx.scale(patternState.scale, patternState.scale);
    ctx.globalAlpha = patternState.alpha;
    
    const patternWidth = patternImg.width * 0.6;
    const patternHeight = patternImg.height * 0.6;
    ctx.drawImage(patternImg, -patternWidth/2, -patternHeight/2, patternWidth, patternHeight);
    
    ctx.restore();
  });
});

// Event listener untuk tombol +/- 
document.querySelectorAll('.step').forEach(btn => {
  btn.addEventListener('click', function() {
    const targetId = this.getAttribute('data-target');
    const step = Number(this.getAttribute('data-step'));
    const target = document.getElementById(targetId);
    
    if (target) {
      let value = Number(target.value);
      value += step;
      
      // Pastikan nilai dalam range
      if (target.min) value = Math.max(Number(target.min), value);
      if (target.max) value = Math.min(Number(target.max), value);
      
      target.value = value;
      target.dispatchEvent(new Event('input'));
    }
  });
});

// Event listener untuk tombol center
document.getElementById('centerBtn').addEventListener('click', function() {
  if (!patternImg) return;
  
  patternState.x = c.width/2;
  patternState.y = c.height/2;
  
  document.getElementById('posX').value = patternState.x;
  document.getElementById('posY').value = patternState.y;
  
  // Trigger input event untuk menggambar ulang
  document.getElementById('posX').dispatchEvent(new Event('input'));
});

// Event listener untuk tombol download
document.getElementById('downloadBtn').addEventListener('click', function() {
  if (!shirtImg && !patternImg) return;
  
  const link = document.createElement('a');
  link.download = 'mockup.png';
  link.href = c.toDataURL('image/png');
  link.click();
});

// Event listener untuk tombol reset
document.getElementById('resetBtn').addEventListener('click', function() {
  shirtImg = null;
  patternImg = null;
  patternState = { 
    x: c.width/2, 
    y: c.height/2, 
    scale: 1, 
    rot: 0, 
    alpha: 1, 
    tiled: false 
  };
  
  // Reset nilai slider
  document.getElementById('posX').value = patternState.x;
  document.getElementById('posY').value = patternState.y;
  document.getElementById('scale').value = patternState.scale;
  document.getElementById('rotation').value = patternState.rot;
  document.getElementById('opacity').value = patternState.alpha;
  
  // Reset file inputs
  document.getElementById('shirtFile').value = '';
  document.getElementById('patternFile').value = '';
  
  // Gambar ulang canvas
  drawCheckerBackground(ctx, c.width, c.height);
  ctx.fillStyle = '#666';
  ctx.font = '16px system-ui';
  ctx.textAlign = 'center';
  ctx.fillText('Upload baju dan motif untuk memulai', c.width/2, c.height/2);
});
</script>
</body>
</html>